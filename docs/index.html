<!doctype html>
<html class="default" lang="en" data-base=".">
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="x-ua-compatible" content="IE=edge" />
		<title>@lesjoursfr/agenda</title>
		<meta name="description" content="Documentation for @lesjoursfr/agenda" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/style.css" />
		<link rel="stylesheet" href="assets/highlight.css" />
		<script defer src="assets/main.js"></script>
		<script async src="assets/icons.js" id="tsd-icons-script"></script>
		<script async src="assets/search.js" id="tsd-search-script"></script>
		<script async src="assets/navigation.js" id="tsd-nav-script"></script>
	</head>
	<body>
		<script>
			document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";
			document.body.style.display = "none";
			setTimeout(() => (app ? app.showPage() : document.body.style.removeProperty("display")), 500);
		</script>
		<header class="tsd-page-toolbar">
			<div class="tsd-toolbar-contents container">
				<div class="table-cell" id="tsd-search">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"
							><svg width="16" height="16" viewBox="0 0 16 16" fill="none">
								<use href="assets/icons.svg#icon-search"></use></svg></label
						><input type="text" id="tsd-search-field" aria-label="Search" />
					</div>
					<div class="field"><div id="tsd-toolbar-links"></div></div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@lesjoursfr/agenda</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"
						><svg width="16" height="16" viewBox="0 0 16 16" fill="none">
							<use href="assets/icons.svg#icon-menu"></use></svg
					></a>
				</div>
			</div>
		</header>
		<div class="container container-main">
			<div class="col-content">
				<div class="tsd-page-title"><h1>@lesjoursfr/agenda</h1></div>
				<div class="tsd-panel tsd-typography">
					<p>
						<a href="https://badge.fury.io/js/@lesjoursfr%2Fagenda" target="_blank" class="external"
							><img src="https://badge.fury.io/js/@lesjoursfr%2Fagenda.svg" alt="npm version"
						/></a>
						<a
							href="https://github.com/lesjoursfr/agenda/actions/workflows/quality-control.yml"
							target="_blank"
							class="external"
							><img
								src="https://github.com/lesjoursfr/agenda/actions/workflows/quality-control.yml/badge.svg"
								alt="QC Checks"
						/></a>
					</p>
					<a id="lesjoursfragenda" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						@lesjoursfr/agenda<a href="#lesjoursfragenda" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p align="center">
						<img
							src="https://cdn.jsdelivr.net/gh/hokify/agenda@master/agendats.png"
							alt="Agenda TS"
							width="100"
							height="100"
						/>
					</p>
					<p align="center">A light-weight job scheduling library for Node.js</p>
					<p>
						This was originally a fork of agenda.js, it differs from the original version in following
						points:
					</p>
					<ul>
						<li>Complete rewrite in Typescript (fully typed!)</li>
						<li>
							<a href="https://www.npmjs.com/package/mongodb" target="_blank" class="external"
								>mongodb@6</a
							>
							driver
						</li>
						<li>Supports mongoDB sharding by name</li>
						<li>touch() can have an optional progress parameter (0-100)</li>
						<li>Bugfixes and improvements for locking &amp; job processing (concurrency, lockLimit,..)</li>
						<li>Breaking change: define() config paramter moved from 2nd position to 3rd</li>
						<li>getRunningStats()</li>
						<li>automatically waits for agenda to be connected before calling any database operations</li>
						<li>uses a database abstraction layer behind the scene</li>
						<li>
							does not create a database index by default, you can set <code>ensureIndex: true</code> when
							initializing Agenda or run manually:
						</li>
					</ul>
					<pre><code><span class="hl-0">db</span><span class="hl-1">.</span><span class="hl-0">agendaJobs</span><span class="hl-1">.</span><span class="hl-2">ensureIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;name&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;nextRunAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;priority&quot;</span><span class="hl-0"> :</span><span class="hl-1"> -</span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;lockedAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;disabled&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><br/><span class="hl-1">}, </span><span class="hl-3">&quot;findAndLockNextJobIndex&quot;</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

					<a id="agenda-offers" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Agenda offers<a href="#agenda-offers" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<ul>
						<li>Minimal overhead. Agenda aims to keep its code base small.</li>
						<li>Mongo backed persistence layer.</li>
						<li>Promises based API.</li>
						<li>Scheduling with configurable priority, concurrency, and repeating.</li>
						<li>Scheduling via cron or human readable syntax.</li>
						<li>Event backed job queue that you can hook into.</li>
						<li>
							<a href="https://github.com/agenda/agendash" target="_blank" class="external">Agendash</a>:
							optional standalone web-interface.
						</li>
						<li>
							<a href="https://github.com/agenda/agenda-rest" target="_blank" class="external"
								>Agenda-rest</a
							>: optional standalone REST API.
						</li>
						<li>
							<a href="https://github.com/lautarobock/inversify-agenda" target="_blank" class="external"
								>inversify-agenda</a
							>
							- Some utilities for the development of agenda workers with Inversify
						</li>
					</ul>
					<a id="feature-comparison" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Feature Comparison<a href="#feature-comparison" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Since there are a few job queue solutions, here a table comparing them to help you use the one
						that better suits your needs.
					</p>
					<table>
						<thead>
							<tr>
								<th style="text-align: left">Feature</th>
								<th style="text-align: center">Bull</th>
								<th style="text-align: center">Bee</th>
								<th style="text-align: center">Agenda</th>
								<th style="text-align: center">AgendaTS</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td style="text-align: left">Backend</td>
								<td style="text-align: center">redis</td>
								<td style="text-align: center">redis</td>
								<td style="text-align: center">mongo</td>
								<td style="text-align: center">mongo</td>
							</tr>
							<tr>
								<td style="text-align: left">Priorities</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Concurrency</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Delayed jobs</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Global events</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Rate Limiter</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
							</tr>
							<tr>
								<td style="text-align: left">Pause/Resume</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Sandboxed worker</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Repeatable jobs</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Atomic ops</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center">~</td>
							</tr>
							<tr>
								<td style="text-align: left">Persistence</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">UI</td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">REST API</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Central (Scalable) Queue</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Supports long running jobs</td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center"></td>
								<td style="text-align: center">✓</td>
							</tr>
							<tr>
								<td style="text-align: left">Optimized for</td>
								<td style="text-align: center">Jobs / Messages</td>
								<td style="text-align: center">Messages</td>
								<td style="text-align: center">Jobs</td>
								<td style="text-align: center">Jobs</td>
							</tr>
						</tbody>
					</table>
					<p>
						<em
							>Kudos for making the comparison chart goes to
							<a
								href="https://www.npmjs.com/package/bull#feature-comparison"
								target="_blank"
								class="external"
								>Bull</a
							>
							maintainers.</em
						>
					</p>
					<a id="installation" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Installation<a href="#installation" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>Install via NPM</p>
					<pre><code>npm install @lesjoursfr/agenda
</code></pre>
					<a id="example-usage" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Example Usage<a href="#example-usage" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">mongoConnectionString</span><span class="hl-1"> = </span><span class="hl-3">&quot;mongodb://127.0.0.1/agenda&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">db:</span><span class="hl-1"> { </span><span class="hl-0">address:</span><span class="hl-1"> </span><span class="hl-0">mongoConnectionString</span><span class="hl-1"> } });</span><br/><br/><span class="hl-7">// Or override the default collection name:</span><br/><span class="hl-7">// const agenda = new Agenda({db: {address: mongoConnectionString, collection: &#39;jobCollectionName&#39;}});</span><br/><br/><span class="hl-7">// or pass additional connection options:</span><br/><span class="hl-7">// const agenda = new Agenda({db: {address: mongoConnectionString, collection: &#39;jobCollectionName&#39;, options: {ssl: true}}});</span><br/><br/><span class="hl-7">// or pass in an existing mongodb-native MongoClient instance</span><br/><span class="hl-7">// const agenda = new Agenda({mongo: myMongoClient});</span><br/><br/><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;delete old users&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">User</span><span class="hl-1">.</span><span class="hl-2">remove</span><span class="hl-1">({ </span><span class="hl-0">lastLogIn:</span><span class="hl-1"> { </span><span class="hl-0">$lt:</span><span class="hl-1"> </span><span class="hl-0">twoDaysAgo</span><span class="hl-1"> } });</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">	</span><span class="hl-7">// IIFE to give access to async/await</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span><br/><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">(</span><span class="hl-3">&quot;3 minutes&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;delete old users&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">	</span><span class="hl-7">// Alternatively, you could also do:</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">(</span><span class="hl-3">&quot;*/3 * * * *&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;delete old users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">})();</span>
</code><button type="button">Copy</button></pre>

					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;send email report&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">to</span><span class="hl-1"> } = </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-0">attrs</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">;</span><br/><span class="hl-1">		</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">emailClient</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">			</span><span class="hl-0">to</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-0">from:</span><span class="hl-1"> </span><span class="hl-3">&quot;example@example.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-0">subject:</span><span class="hl-1"> </span><span class="hl-3">&quot;Email Report&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-0">body:</span><span class="hl-1"> </span><span class="hl-3">&quot;...&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">		});</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	{ </span><span class="hl-0">priority:</span><span class="hl-1"> </span><span class="hl-3">&quot;high&quot;</span><span class="hl-1">, </span><span class="hl-0">concurrency:</span><span class="hl-1"> </span><span class="hl-4">10</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">schedule</span><span class="hl-1">(</span><span class="hl-3">&quot;in 20 minutes&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;send email report&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">		</span><span class="hl-0">to:</span><span class="hl-1"> </span><span class="hl-3">&quot;admin@example.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">})();</span>
</code><button type="button">Copy</button></pre>

					<pre><code class="js"><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> () {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">weeklyReport</span><span class="hl-1"> = </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">create</span><span class="hl-1">(</span><span class="hl-3">&quot;send email report&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">		</span><span class="hl-0">to:</span><span class="hl-1"> </span><span class="hl-3">&quot;example@example.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">weeklyReport</span><span class="hl-1">.</span><span class="hl-2">repeatEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;1 week&quot;</span><span class="hl-1">).</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">})();</span>
</code><button type="button">Copy</button></pre>

					<a id="full-documentation" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Full documentation<a href="#full-documentation" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>
						See also
						<a href="https://hokify.github.io/agenda/" target="_blank" class="external"
							>https://hokify.github.io/agenda/</a
						>
					</p>
					<p>
						Agenda's basic control structure is an instance of an agenda. Agenda's are mapped to a database
						collection and load the jobs from within.
					</p>
					<a id="table-of-contents" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Table of Contents<a href="#table-of-contents" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<ul>
						<li><a href="#configuring-an-agenda">Configuring an agenda</a></li>
						<li><a href="#agenda-events">Agenda Events</a></li>
						<li><a href="#defining-job-processors">Defining job processors</a></li>
						<li><a href="#creating-jobs">Creating jobs</a></li>
						<li><a href="#managing-jobs">Managing jobs</a></li>
						<li><a href="#starting-the-job-processor">Starting the job processor</a></li>
						<li><a href="#multiple-job-processors">Multiple job processors</a></li>
						<li><a href="#manually-working-with-a-job">Manually working with jobs</a></li>
						<li><a href="#job-queue-events">Job Queue Events</a></li>
						<li><a href="#frequently-asked-questions">Frequently asked questions</a></li>
						<li><a href="#example-project-structure">Example Project structure</a></li>
						<li><a href="#known-issues">Known Issues</a></li>
						<li><a href="#debugging-issues">Debugging Issues</a></li>
						<li><a href="#acknowledgements">Acknowledgements</a></li>
					</ul>
					<a id="configuring-an-agenda" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Configuring an agenda<a
							href="#configuring-an-agenda"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>All configuration methods are chainable, meaning you can do something like:</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">();</span><br/><span class="hl-0">agenda</span><br/><span class="hl-1">  .</span><span class="hl-2">database</span><span class="hl-1">(...)</span><br/><span class="hl-1">  .</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&#39;3 minutes&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  ...;</span>
</code><button type="button">Copy</button></pre>

					<p>Possible agenda config options:</p>
					<pre><code class="ts"><span class="hl-1">{</span><br/><span class="hl-1">	</span><span class="hl-9">name</span><span class="hl-1">: </span><span class="hl-0">string</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">defaultConcurrency</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">processEvery</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">maxConcurrency</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">defaultLockLimit</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">lockLimit</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">defaultLockLifetime</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">ensureIndex</span><span class="hl-1">: </span><span class="hl-0">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-9">sort</span><span class="hl-1">: </span><span class="hl-0">SortOptionObject</span><span class="hl-1">&lt;</span><span class="hl-0">IJobParameters</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">	</span><span class="hl-9">db</span><span class="hl-1">: {</span><br/><span class="hl-1">		</span><span class="hl-9">collection</span><span class="hl-1">: </span><span class="hl-0">string</span><span class="hl-1">;</span><br/><span class="hl-1">		</span><span class="hl-9">address</span><span class="hl-1">: </span><span class="hl-0">string</span><span class="hl-1">;</span><br/><span class="hl-1">		</span><span class="hl-9">options</span><span class="hl-1">: </span><span class="hl-0">MongoClientOptions</span><span class="hl-1">;</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">	</span><span class="hl-9">mongo</span><span class="hl-1">: </span><span class="hl-0">Db</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

					<p>
						Agenda uses
						<a href="http://github.com/rschmukler/human-interval" target="_blank" class="external"
							>Human Interval</a
						>
						for specifying the intervals. It supports the following units:
					</p>
					<p>
						<code>seconds</code>, <code>minutes</code>, <code>hours</code>,
						<code>days</code>,<code>weeks</code>, <code>months</code> -- assumes 30 days,
						<code>years</code> -- assumes 365 days
					</p>
					<p>More sophisticated examples</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;one minute&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;1.5 minutes&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;3 days and 4 hours&quot;</span><span class="hl-1">);</span><br/><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;3 days, 4 hours and 36 seconds&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<a id="databaseurl-collectionname-mongoclientoptions" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						database(url, [collectionName], [MongoClientOptions])<a
							href="#databaseurl-collectionname-mongoclientoptions"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Specifies the database at the <code>url</code> specified. If no collection name is given,
						<code>agendaJobs</code> is used.
					</p>
					<p>
						By default <code>useNewUrlParser</code> and <code>useUnifiedTopology</code> is set to
						<code>true</code>,
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">database</span><span class="hl-1">(</span><span class="hl-3">&quot;localhost:27017/agenda-test&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;agendaJobs&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation.</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({</span><br/><span class="hl-1">	</span><span class="hl-0">db:</span><span class="hl-1"> { </span><span class="hl-0">address:</span><span class="hl-1"> </span><span class="hl-3">&quot;localhost:27017/agenda-test&quot;</span><span class="hl-1">, </span><span class="hl-0">collection:</span><span class="hl-1"> </span><span class="hl-3">&quot;agendaJobs&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<p>
						Agenda will emit a <code>ready</code> event (see <a href="#agenda-events">Agenda Events</a>)
						when properly connected to the database. It is safe to call <code>agenda.start()</code> without
						waiting for this event, as this is handled internally. If you're using the
						<code>db</code> options, or call <code>database</code>, then you may still need to listen for
						<code>ready</code> before saving jobs.
					</p>
					<a id="mongodbinstance-collectionname" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						mongo(dbInstance, [collectionName])<a
							href="#mongodbinstance-collectionname"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Use an existing mongodb-native MongoClient/Db instance. This can help consolidate connections to
						a database. You can instead use <code>.database</code> to have agenda handle connecting for you.
					</p>
					<p>You can also specify it during instantiation:</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">mongo:</span><span class="hl-1"> </span><span class="hl-0">mongoClientInstance</span><span class="hl-1">.</span><span class="hl-2">db</span><span class="hl-1">(</span><span class="hl-3">&quot;agenda-test&quot;</span><span class="hl-1">) });</span>
</code><button type="button">Copy</button></pre>

					<p>
						Note that MongoClient.connect() returns a mongoClientInstance since
						<a
							href="https://github.com/mongodb/node-mongodb-native/blob/master/CHANGES_3.0.0.md"
							target="_blank"
							class="external"
							>node-mongodb-native 3.0.0</a
						>, while it used to return a dbInstance that could then be directly passed to agenda.
					</p>
					<a id="namename" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						name(name)<a href="#namename" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a string <code>name</code> and sets <code>lastModifiedBy</code> to it in the job database.
						Useful for if you have multiple job processors (agendas) and want to see which job queue last
						ran the job.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">name</span><span class="hl-1">(</span><span class="hl-0">os</span><span class="hl-1">.</span><span class="hl-0">hostname</span><span class="hl-1"> + </span><span class="hl-3">&quot;-&quot;</span><span class="hl-1"> + </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">pid</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;test queue&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="processeveryinterval" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						processEvery(interval)<a
							href="#processeveryinterval"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a string <code>interval</code> which can be either a traditional javascript number, or a
						string such as <code>3 minutes</code>
					</p>
					<p>
						Specifies the frequency at which agenda will query the database looking for jobs that need to be
						processed. Agenda internally uses <code>setTimeout</code> to guarantee that jobs run at (close
						to ~3ms) the right time.
					</p>
					<p>
						Decreasing the frequency will result in fewer database queries, but more jobs being stored in
						memory.
					</p>
					<p>
						Also worth noting is that if the job queue is shutdown, any jobs stored in memory that haven't
						run will still be locked, meaning that you may have to wait for the lock to expire. By default
						it is <code>'5 seconds'</code>.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">processEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;1 minute&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">processEvery:</span><span class="hl-1"> </span><span class="hl-3">&quot;30 seconds&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="maxconcurrencynumber" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						maxConcurrency(number)<a
							href="#maxconcurrencynumber"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>number</code> which specifies the max number of jobs that can be running at any
						given moment. By default it is <code>20</code>.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">maxConcurrency</span><span class="hl-1">(</span><span class="hl-4">20</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">maxConcurrency:</span><span class="hl-1"> </span><span class="hl-4">20</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="defaultconcurrencynumber" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						defaultConcurrency(number)<a
							href="#defaultconcurrencynumber"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>number</code> which specifies the default number of a specific job that can be
						running at any given moment. By default it is <code>5</code>.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">defaultConcurrency</span><span class="hl-1">(</span><span class="hl-4">5</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">defaultConcurrency:</span><span class="hl-1"> </span><span class="hl-4">5</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="locklimitnumber" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						lockLimit(number)<a href="#locklimitnumber" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>number</code> which specifies the max number jobs that can be locked at any given
						moment. By default it is <code>0</code> for no max.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">lockLimit</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">lockLimit:</span><span class="hl-1"> </span><span class="hl-4">0</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="defaultlocklimitnumber" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						defaultLockLimit(number)<a
							href="#defaultlocklimitnumber"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>number</code> which specifies the default number of a specific job that can be
						locked at any given moment. By default it is <code>0</code> for no max.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">defaultLockLimit</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">defaultLockLimit:</span><span class="hl-1"> </span><span class="hl-4">0</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="defaultlocklifetimenumber" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						defaultLockLifetime(number)<a
							href="#defaultlocklifetimenumber"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>number</code> which specifies the default lock lifetime in milliseconds. By
						default it is 10 minutes. This can be overridden by specifying the
						<code>lockLifetime</code> option to a defined job.
					</p>
					<p>
						A job will unlock if it is finished (ie. the returned Promise resolves/rejects or
						<code>done</code> is specified in the params and <code>done()</code> is called) before the
						<code>lockLifetime</code>. The lock is useful if the job crashes or times out.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">defaultLockLifetime</span><span class="hl-1">(</span><span class="hl-4">10000</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>You can also specify it during instantiation</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">defaultLockLifetime:</span><span class="hl-1"> </span><span class="hl-4">10000</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<a id="sortquery" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						sort(query)<a href="#sortquery" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Takes a <code>query</code> which specifies the sort query to be used for finding and locking the
						next job.
					</p>
					<p>
						By default it is <code>{ nextRunAt: 1, priority: -1 }</code>, which obeys a first in first out
						approach, with respect to priority.
					</p>
					<a id="agenda-events" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Agenda Events<a href="#agenda-events" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>An instance of an agenda will emit the following events:</p>
					<ul>
						<li>
							<code>ready</code> - called when Agenda mongo connection is successfully opened and indices
							created. If you're passing agenda an existing connection, you shouldn't need to listen for
							this, as <code>agenda.start()</code> will not resolve until indices have been created. If
							you're using the <code>db</code> options, or call <code>database</code>, then you may still
							need to listen for the <code>ready</code> event before saving jobs.
							<code>agenda.start()</code> will still wait for the connection to be opened.
						</li>
						<li><code>error</code> - called when Agenda mongo connection process has thrown an error</li>
					</ul>
					<pre><code class="js"><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="defining-job-processors" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Defining Job Processors<a
							href="#defining-job-processors"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>Before you can use a job, you must define its processing behavior.</p>
					<a id="definejobname-fn-options" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						define(jobName, fn, [options])<a
							href="#definejobname-fn-options"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Defines a job with the name of <code>jobName</code>. When a job of <code>jobName</code> gets
						run, it will be passed to <code>fn(job, done)</code>. To maintain asynchronous behavior, you may
						either provide a Promise-returning function in <code>fn</code> <em>or</em> provide
						<code>done</code> as a second parameter to <code>fn</code>. If <code>done</code> is specified in
						the function signature, you must call <code>done()</code> when you are processing the job. If
						your function is synchronous or returns a Promise, you may omit <code>done</code> from the
						signature.
					</p>
					<p>
						<code>options</code> is an optional argument which can overwrite the defaults. It can take the
						following:
					</p>
					<ul>
						<li>
							<code>concurrency</code>: <code>number</code> maximum number of that job that can be running
							at once (per instance of agenda)
						</li>
						<li>
							<code>lockLimit</code>: <code>number</code> maximum number of that job that can be locked at
							once (per instance of agenda)
						</li>
						<li>
							<code>lockLifetime</code>: <code>number</code> interval in ms of how long the job stays
							locked for (see <a href="#multiple-job-processors">multiple job processors</a> for more
							info). A job will automatically unlock once a returned promise resolves/rejects (or if
							<code>done</code> is specified in the signature and <code>done()</code> is called).
						</li>
						<li>
							<code>priority</code>: <code>(lowest|low|normal|high|highest|number)</code> specifies the
							priority of the job. Higher priority jobs will run first. See the priority mapping below
						</li>
					</ul>
					<p>Priority mapping:</p>
					<pre><code><span class="hl-1">{</span><br/><span class="hl-1">  </span><span class="hl-9">highest</span><span class="hl-1">: </span><span class="hl-4">20</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">high</span><span class="hl-1">: </span><span class="hl-4">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">normal</span><span class="hl-1">: </span><span class="hl-4">0</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">low</span><span class="hl-1">: -</span><span class="hl-4">10</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-9">lowest</span><span class="hl-1">: -</span><span class="hl-4">20</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>

					<p>Async Job:</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;some long running job&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">doSomelengthyTask</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">formatThatData</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">sendThatData</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<p>Async Job (using <code>done</code>):</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;some long running job&quot;</span><span class="hl-1">, (</span><span class="hl-0">job</span><span class="hl-1">, </span><span class="hl-0">done</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-2">doSomelengthyTask</span><span class="hl-1">((</span><span class="hl-0">data</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-2">formatThatData</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">		</span><span class="hl-2">sendThatData</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">		</span><span class="hl-2">done</span><span class="hl-1">();</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<p>Sync Job:</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;say hello&quot;</span><span class="hl-1">, (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Hello!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<p>
						<code>define()</code> acts like an assignment: if <code>define(jobName, ...)</code> is called
						multiple times (e.g. every time your script starts), the definition in the last call will
						overwrite the previous one. Thus, if you <code>define</code> the <code>jobName</code> only once
						in your code, it's safe for that call to execute multiple times.
					</p>
					<a id="creating-jobs" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Creating Jobs<a href="#creating-jobs" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<a id="everyinterval-name-data-options" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						every(interval, name, [data], [options])<a
							href="#everyinterval-name-data-options"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Runs job <code>name</code> at the given <code>interval</code>. Optionally, data and options can
						be passed in. Every creates a job of type <code>single</code>, which means that it will only
						create one job in the database, even if that line is run multiple times. This lets you put it in
						a file that may get run multiple times, such as <code>webserver.js</code> which may reboot from
						time to time.
					</p>
					<p>
						<code>interval</code> can be a human-readable format <code>String</code>, a
						<a href="https://www.npmjs.com/package/cron-parser" target="_blank" class="external"
							>cron format</a
						>
						<code>String</code>, or a <code>Number</code>.
					</p>
					<p>
						<code>data</code> is an optional argument that will be passed to the processing function under
						<code>job.attrs.data</code>.
					</p>
					<p>
						<code>options</code> is an optional argument that will be passed to
						<a href="#repeateveryinterval-options"><code>job.repeatEvery</code></a
						>. In order to use this argument, <code>data</code> must also be specified.
					</p>
					<p>Returns the <code>job</code>.</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">User</span><span class="hl-1">.</span><span class="hl-2">doSomethingReallyIntensive</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-2">processUserData</span><span class="hl-1">(</span><span class="hl-0">users</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;I print a report!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">(</span><span class="hl-3">&quot;15 minutes&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>
						Optionally, <code>name</code> could be array of job names, which is convenient for scheduling
						different jobs for same <code>interval</code>.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">(</span><span class="hl-3">&quot;15 minutes&quot;</span><span class="hl-1">, [</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;sendNotifications&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;updateUserRecords&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

					<p>In this case, <code>every</code> returns array of <code>jobs</code>.</p>
					<a id="schedulewhen-name-data" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						schedule(when, name, [data])<a
							href="#schedulewhen-name-data"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Schedules a job to run <code>name</code> once at a given time. <code>when</code> can be a
						<code>Date</code> or a <code>String</code> such as <code>tomorrow at 5pm</code>.
					</p>
					<p>
						<code>data</code> is an optional argument that will be passed to the processing function under
						<code>job.attrs.data</code>.
					</p>
					<p>Returns the <code>job</code>.</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">schedule</span><span class="hl-1">(</span><span class="hl-3">&quot;tomorrow at noon&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">, { </span><span class="hl-0">userCount:</span><span class="hl-1"> </span><span class="hl-4">100</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<p>
						Optionally, <code>name</code> could be array of job names, similar to the
						<code>every</code> method.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">schedule</span><span class="hl-1">(</span><span class="hl-3">&quot;tomorrow at noon&quot;</span><span class="hl-1">, [</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;sendNotifications&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;updateUserRecords&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">]);</span>
</code><button type="button">Copy</button></pre>

					<p>In this case, <code>schedule</code> returns array of <code>jobs</code>.</p>
					<a id="nowname-data" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						now(name, [data])<a href="#nowname-data" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Schedules a job to run <code>name</code> once immediately.</p>
					<p>
						<code>data</code> is an optional argument that will be passed to the processing function under
						<code>job.attrs.data</code>.
					</p>
					<p>Returns the <code>job</code>.</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">now</span><span class="hl-1">(</span><span class="hl-3">&quot;do the hokey pokey&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<a id="createjobname-data" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						create(jobName, data)<a
							href="#createjobname-data"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Returns an instance of a <code>jobName</code> with <code>data</code>. This does
						<em>NOT</em> save the job in the database. See below to learn how to manually work with jobs.
					</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">job</span><span class="hl-1"> = </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">create</span><span class="hl-1">(</span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1">, { </span><span class="hl-0">userCount:</span><span class="hl-1"> </span><span class="hl-4">100</span><span class="hl-1"> });</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Job successfully saved&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<a id="managing-jobs" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Managing Jobs<a href="#managing-jobs" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<a
						id="jobsmongodb-native-query-mongodb-native-sort-mongodb-native-limit-mongodb-native-skip"
						class="tsd-anchor"
					></a>
					<h3 class="tsd-anchor-link">
						jobs(mongodb-native query, mongodb-native sort, mongodb-native limit, mongodb-native skip)<a
							href="#jobsmongodb-native-query-mongodb-native-sort-mongodb-native-limit-mongodb-native-skip"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Lets you query (then sort, limit and skip the result) all of the jobs in the agenda job's
						database. These are full
						<a href="https://github.com/mongodb/node-mongodb-native" target="_blank" class="external"
							>mongodb-native</a
						>
						<code>find</code>, <code>sort</code>, <code>limit</code> and <code>skip</code> commands. See
						mongodb-native's documentation for details.
					</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">jobs</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">jobs</span><span class="hl-1">(</span><br/><span class="hl-1">	{ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">	{ </span><span class="hl-0">data:</span><span class="hl-1"> -</span><span class="hl-4">1</span><span class="hl-1"> },</span><br/><span class="hl-1">	</span><span class="hl-4">3</span><span class="hl-1">,</span><br/><span class="hl-1">	</span><span class="hl-4">1</span><br/><span class="hl-1">);</span><br/><span class="hl-7">// Work with jobs (see below)</span>
</code><button type="button">Copy</button></pre>

					<a id="cancelmongodb-native-query" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						cancel(mongodb-native query)<a
							href="#cancelmongodb-native-query"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Cancels any jobs matching the passed mongodb-native query, and removes them from the database.
						Returns a Promise resolving to the number of cancelled jobs, or rejecting on error.
					</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">numRemoved</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">cancel</span><span class="hl-1">({ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;printAnalyticsReport&quot;</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

					<p>
						This functionality can also be achieved by first retrieving all the jobs from the database using
						<code>agenda.jobs()</code>, looping through the resulting array and calling
						<code>job.remove()</code> on each. It is however preferable to use
						<code>agenda.cancel()</code> for this use case, as this ensures the operation is atomic.
					</p>
					<a id="purge" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						purge()<a href="#purge" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Removes all jobs in the database without defined behaviors. Useful if you change a definition
						name and want to remove old jobs. Returns a Promise resolving to the number of removed jobs, or
						rejecting on error.
					</p>
					<p>
						<em>IMPORTANT:</em> Do not run this before you finish defining all of your jobs. If you do, you
						will nuke your database of jobs.
					</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">numRemoved</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">purge</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="starting-the-job-processor" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Starting the job processor<a
							href="#starting-the-job-processor"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>
						To get agenda to start processing jobs from the database you must start it. This will schedule
						an interval (based on <code>processEvery</code>) to check for new jobs and run them. You can
						also stop the queue.
					</p>
					<a id="start" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						start<a href="#start" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Starts the job queue processing, checking
						<a href="#processeveryinterval"><code>processEvery</code></a> time to see if there are new jobs.
						Must be called <em>after</em> <code>processEvery</code>, and <em>before</em> any job scheduling
						(e.g. <code>every</code>).
					</p>
					<a id="stop" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						stop<a href="#stop" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Stops the job queue processing. Unlocks currently running jobs.</p>
					<p>
						This can be very useful for graceful shutdowns so that currently running/grabbed jobs are
						abandoned so that other job queues can grab them / they are unlocked should the job queue start
						again. Here is an example of how to do a graceful shutdown.
					</p>
					<pre><code class="js"><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">graceful</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">stop</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">exit</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;SIGTERM&quot;</span><span class="hl-1">, </span><span class="hl-0">graceful</span><span class="hl-1">);</span><br/><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;SIGINT&quot;</span><span class="hl-1">, </span><span class="hl-0">graceful</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<a id="multiple-job-processors" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Multiple job processors<a
							href="#multiple-job-processors"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>
						Sometimes you may want to have multiple node instances / machines process from the same queue.
						Agenda supports a locking mechanism to ensure that multiple queues don't process the same job.
					</p>
					<p>
						You can configure the locking mechanism by specifying <code>lockLifetime</code> as an interval
						when defining the job.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><br/><span class="hl-1">	</span><span class="hl-3">&quot;someJob&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">	(</span><span class="hl-0">job</span><span class="hl-1">, </span><span class="hl-0">cb</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-7">// Do something in 10 seconds or less...</span><br/><span class="hl-1">	},</span><br/><span class="hl-1">	{ </span><span class="hl-0">lockLifetime:</span><span class="hl-1"> </span><span class="hl-4">10000</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>
						This will ensure that no other job processor (this one included) attempts to run the job again
						for the next 10 seconds. If you have a particularly long running job, you will want to specify a
						longer lockLifetime.
					</p>
					<p>
						By default it is 10 minutes. Typically you shouldn't have a job that runs for 10 minutes, so
						this is really insurance should the job queue crash before the job is unlocked.
					</p>
					<p>
						When a job is finished (i.e. the returned promise resolves/rejects or <code>done</code> is
						specified in the signature and <code>done()</code> is called), it will automatically unlock.
					</p>
					<a id="manually-working-with-a-job" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Manually working with a job<a
							href="#manually-working-with-a-job"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>
						A job instance has many instance methods. All mutating methods must be followed with a call to
						<code>await job.save()</code> in order to persist the changes to the database.
					</p>
					<a id="repeateveryinterval-options" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						repeatEvery(interval, [options])<a
							href="#repeateveryinterval-options"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Specifies an <code>interval</code> on which the job should repeat. The job runs at the time of
						defining as well in configured intervals, that is &quot;run <em>now</em> and in intervals&quot;.
					</p>
					<p>
						<code>interval</code> can be a human-readable format <code>String</code>, a
						<a href="https://www.npmjs.com/package/cron-parser" target="_blank" class="external"
							>cron format</a
						>
						<code>String</code>, or a <code>Number</code>.
					</p>
					<p><code>options</code> is an optional argument containing:</p>
					<p>
						<code>options.timezone</code>: should be a string as accepted by
						<a href="https://momentjs.com/timezone/" target="_blank" class="external">moment-timezone</a>
						and is considered when using an interval in the cron string format.
					</p>
					<p>
						<code>options.skipImmediate</code>: <code>true</code> | <code>false</code> (default) Setting
						this <code>true</code> will skip the immediate run. The first run will occur only in configured
						interval.
					</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">repeatEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;10 minutes&quot;</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">repeatEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;3 minutes&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-0">skipImmediate:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">repeatEvery</span><span class="hl-1">(</span><span class="hl-3">&quot;0 6 * * *&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">	</span><span class="hl-0">timezone:</span><span class="hl-1"> </span><span class="hl-3">&quot;America/New_York&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="repeatattime" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						repeatAt(time)<a href="#repeatattime" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Specifies a <code>time</code> when the job should repeat.
						<a href="https://github.com/matthewmueller/date#examples" target="_blank" class="external"
							>Possible values</a
						>
					</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">repeatAt</span><span class="hl-1">(</span><span class="hl-3">&quot;3:30pm&quot;</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="scheduletime" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						schedule(time)<a href="#scheduletime" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Specifies the next <code>time</code> at which the job should run.</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">schedule</span><span class="hl-1">(</span><span class="hl-3">&quot;tomorrow at 6pm&quot;</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="prioritypriority" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						priority(priority)<a href="#prioritypriority" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Specifies the <code>priority</code> weighting of the job. Can be a number or a string from the
						above priority table.
					</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">priority</span><span class="hl-1">(</span><span class="hl-3">&quot;low&quot;</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="uniqueproperties-options" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						unique(properties, [options])<a
							href="#uniqueproperties-options"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Ensure that only one instance of this job exists with the specified properties</p>
					<p>
						<code>options</code> is an optional argument which can overwrite the defaults. It can take the
						following:
					</p>
					<ul>
						<li>
							<code>insertOnly</code>: <code>boolean</code> will prevent any properties from persisting if
							the job already exists. Defaults to false.
						</li>
					</ul>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">unique</span><span class="hl-1">({ </span><span class="hl-3">&quot;data.type&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">&quot;active&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;data.userId&quot;</span><span class="hl-0">:</span><span class="hl-1"> </span><span class="hl-3">&quot;123&quot;</span><span class="hl-1">, </span><span class="hl-0">nextRunAt:</span><span class="hl-1"> </span><span class="hl-0">date</span><span class="hl-1"> });</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<p>
						<em>IMPORTANT:</em> To avoid high CPU usage by MongoDB, make sure to create an index on the used
						fields, like <code>data.type</code> and <code>data.userId</code> for the example above.
					</p>
					<a id="failreason" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						fail(reason)<a href="#failreason" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Sets <code>job.attrs.failedAt</code> to <code>now</code>, and sets
						<code>job.attrs.failReason</code> to <code>reason</code>.
					</p>
					<p>
						Optionally, <code>reason</code> can be an error, in which case
						<code>job.attrs.failReason</code> will be set to <code>error.message</code>
					</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">fail</span><span class="hl-1">(</span><span class="hl-3">&quot;insufficient disk space&quot;</span><span class="hl-1">);</span><br/><span class="hl-7">// or</span><br/><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">fail</span><span class="hl-1">(</span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Error</span><span class="hl-1">(</span><span class="hl-3">&quot;insufficient disk space&quot;</span><span class="hl-1">));</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="runcallback" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						run(callback)<a href="#runcallback" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Runs the given <code>job</code> and calls <code>callback(err, job)</code> upon completion.
						Normally you never need to call this manually.
					</p>
					<pre><code class="js"><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">run</span><span class="hl-1">((</span><span class="hl-0">err</span><span class="hl-1">, </span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;I don&#39;t know why you would need to do this...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<a id="save" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						save()<a href="#save" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Saves the <code>job.attrs</code> into the database. Returns a Promise resolving to a Job
						instance, or rejecting on error.
					</p>
					<pre><code class="js"><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-0">cosole</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Successfully saved job to collection&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">e</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&quot;Error saving job to collection&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

					<a id="remove" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						remove()<a href="#remove" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Removes the <code>job</code> from the database. Returns a Promise resolving to the number of
						jobs removed, or rejecting on error.
					</p>
					<pre><code class="js"><span class="hl-8">try</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">remove</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Successfully removed job from collection&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-8">catch</span><span class="hl-1"> (</span><span class="hl-0">e</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&quot;Error removing job from collection&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

					<a id="disable" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						disable()<a href="#disable" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Disables the <code>job</code>. Upcoming runs won't execute.</p>
					<a id="enable" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						enable()<a href="#enable" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>Enables the <code>job</code> if it got disabled before. Upcoming runs will execute.</p>
					<a id="touch" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						touch()<a href="#touch" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Resets the lock on the job. Useful to indicate that the job hasn't timed out when you have very
						long running jobs. The call returns a promise that resolves when the job's lock has been
						renewed.
					</p>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;super long job&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">doSomeLongTask</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">touch</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">doAnotherLongTask</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">touch</span><span class="hl-1">();</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">finishOurLongTasks</span><span class="hl-1">();</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<a id="job-queue-events" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Job Queue Events<a href="#job-queue-events" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<p>An instance of an agenda will emit the following events:</p>
					<ul>
						<li><code>start</code> - called just before a job starts</li>
						<li><code>start:job name</code> - called just before the specified job starts</li>
					</ul>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;start&quot;</span><span class="hl-1">, (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&quot;Job %s starting&quot;</span><span class="hl-1">, </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-0">attrs</span><span class="hl-1">.</span><span class="hl-0">name</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<ul>
						<li>
							<code>complete</code> - called when a job finishes, regardless of if it succeeds or fails
						</li>
						<li>
							<code>complete:job name</code> - called when a job finishes, regardless of if it succeeds or
							fails
						</li>
					</ul>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;complete&quot;</span><span class="hl-1">, (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">`Job </span><span class="hl-5">${</span><span class="hl-0">job</span><span class="hl-10">.</span><span class="hl-0">attrs</span><span class="hl-10">.</span><span class="hl-0">name</span><span class="hl-5">}</span><span class="hl-3"> finished`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<ul>
						<li><code>success</code> - called when a job finishes successfully</li>
						<li><code>success:job name</code> - called when a job finishes successfully</li>
					</ul>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;success:send email&quot;</span><span class="hl-1">, (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">`Sent Email Successfully to </span><span class="hl-5">${</span><span class="hl-0">job</span><span class="hl-10">.</span><span class="hl-0">attrs</span><span class="hl-10">.</span><span class="hl-0">data</span><span class="hl-10">.</span><span class="hl-0">to</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<ul>
						<li><code>fail</code> - called when a job throws an error</li>
						<li><code>fail:job name</code> - called when a job throws an error</li>
					</ul>
					<pre><code class="js"><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;fail:send email&quot;</span><span class="hl-1">, (</span><span class="hl-0">err</span><span class="hl-1">, </span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">`Job failed with error: </span><span class="hl-5">${</span><span class="hl-0">err</span><span class="hl-10">.</span><span class="hl-0">message</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<a id="frequently-asked-questions" class="tsd-anchor"></a>
					<h2 class="tsd-anchor-link">
						Frequently Asked Questions<a
							href="#frequently-asked-questions"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h2>
					<a id="what-is-the-order-in-which-jobs-run" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						What is the order in which jobs run?<a
							href="#what-is-the-order-in-which-jobs-run"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Jobs are run with priority in a first in first out order (so they will be run in the order they
						were scheduled AND with respect to highest priority).
					</p>
					<p>
						For example, if we have two jobs named &quot;send-email&quot; queued (both with the same
						priority), and the first job is queued at 3:00 PM and second job is queued at 3:05 PM with the
						same <code>priority</code> value, then the first job will run first if we start to send
						&quot;send-email&quot; jobs at 3:10 PM. However if the first job has a priority of
						<code>5</code> and the second job has a priority of <code>10</code>, then the second will run
						first (priority takes precedence) at 3:10 PM.
					</p>
					<p>
						The default
						<a
							href="https://docs.mongodb.com/manual/reference/method/cursor.sort/"
							target="_blank"
							class="external"
							>MongoDB sort object</a
						>
						is <code>{ nextRunAt: 1, priority: -1 }</code> and can be changed through the option
						<code>sort</code> when configuring Agenda.
					</p>
					<a id="what-is-the-difference-between-locklimit-and-maxconcurrency" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						What is the difference between <code>lockLimit</code> and <code>maxConcurrency</code>?<a
							href="#what-is-the-difference-between-locklimit-and-maxconcurrency"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Agenda will lock jobs 1 by one, setting the <code>lockedAt</code> property in mongoDB, and
						creating an instance of the <code>Job</code> class which it caches into the
						<code>_lockedJobs</code> array. This defaults to having no limit, but can be managed using
						lockLimit. If all jobs will need to be run before agenda's next interval (set via
						<code>agenda.processEvery</code>), then agenda will attempt to lock all jobs.
					</p>
					<p>
						Agenda will also pull jobs from <code>_lockedJobs</code> and into <code>_runningJobs</code>.
						These jobs are actively being worked on by user code, and this is limited by
						<code>maxConcurrency</code> (defaults to 20).
					</p>
					<p>
						If you have multiple instances of agenda processing the same job definition with a fast repeat
						time you may find they get unevenly loaded. This is because they will compete to lock as many
						jobs as possible, even if they don't have enough concurrency to process them. This can be
						resolved by tweaking the <code>maxConcurrency</code> and <code>lockLimit</code> properties.
					</p>
					<a id="sample-project-structure" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Sample Project Structure?<a
							href="#sample-project-structure"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Agenda doesn't have a preferred project structure and leaves it to the user to choose how they
						would like to use it. That being said, you can check out the
						<a href="#example-project-structure">example project structure</a> below.
					</p>
					<a id="can-i-donate" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Can I Donate?<a href="#can-i-donate" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Thanks! I'm flattered, but it's really not necessary. If you really want to, you can find my
						<a href="https://www.gittip.com/rschmukler/" target="_blank" class="external">gittip here</a>.
					</p>
					<a id="web-interface" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Web Interface?<a href="#web-interface" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Agenda itself does not have a web interface built in but we do offer stand-alone web interface
						<a href="https://github.com/agenda/agendash" target="_blank" class="external">Agendash</a>:
					</p>
					<p>
						<a href="https://raw.githubusercontent.com/agenda/agendash/master/job-details.png"
							><img
								src="https://raw.githubusercontent.com/agenda/agendash/master/job-details.png"
								style="max-width: 100%"
								alt="Agendash interface"
						/></a>
					</p>
					<a id="mongo-vs-redis" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Mongo vs Redis<a href="#mongo-vs-redis" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						The decision to use Mongo instead of Redis is intentional. Redis is often used for non-essential
						data (such as sessions) and without configuration doesn't guarantee the same level of
						persistence as Mongo (should the server need to be restarted/crash).
					</p>
					<p>
						Agenda decides to focus on persistence without requiring special configuration of Redis (thereby
						degrading the performance of the Redis server on non-critical data, such as sessions).
					</p>
					<p>
						Ultimately if enough people want a Redis driver instead of Mongo, I will write one. (Please open
						an issue requesting it). For now, Agenda decided to focus on guaranteed persistence.
					</p>
					<a id="spawning--forking-processes" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Spawning / forking processes<a
							href="#spawning--forking-processes"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Ultimately Agenda can work from a single job queue across multiple machines, node processes, or
						forks. If you are interested in having more than one worker,
						<a href="http://github.com/bars3s" target="_blank" class="external">Bars3s</a> has written up a
						fantastic example of how one might do it:
					</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">cluster</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;cluster&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">os</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;os&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">httpServer</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;./app/http-server&quot;</span><span class="hl-1">);</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">jobWorker</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;./app/job-worker&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">jobWorkers</span><span class="hl-1"> = [];</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">webWorkers</span><span class="hl-1"> = [];</span><br/><br/><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">cluster</span><span class="hl-1">.</span><span class="hl-0">isMaster</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">cpuCount</span><span class="hl-1"> = </span><span class="hl-0">os</span><span class="hl-1">.</span><span class="hl-2">cpus</span><span class="hl-1">().</span><span class="hl-0">length</span><span class="hl-1">;</span><br/><span class="hl-1">	</span><span class="hl-7">// Create a worker for each CPU</span><br/><span class="hl-1">	</span><span class="hl-8">for</span><span class="hl-1"> (</span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-0">i</span><span class="hl-1"> = </span><span class="hl-4">0</span><span class="hl-1">; </span><span class="hl-0">i</span><span class="hl-1"> &lt; </span><span class="hl-0">cpuCount</span><span class="hl-1">; </span><span class="hl-0">i</span><span class="hl-1"> += </span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-2">addJobWorker</span><span class="hl-1">();</span><br/><span class="hl-1">		</span><span class="hl-2">addWebWorker</span><span class="hl-1">();</span><br/><span class="hl-1">	}</span><br/><br/><span class="hl-1">	</span><span class="hl-0">cluster</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&quot;exit&quot;</span><span class="hl-1">, (</span><span class="hl-0">worker</span><span class="hl-1">, </span><span class="hl-0">code</span><span class="hl-1">, </span><span class="hl-0">signal</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">jobWorkers</span><span class="hl-1">.</span><span class="hl-2">indexOf</span><span class="hl-1">(</span><span class="hl-0">worker</span><span class="hl-1">.</span><span class="hl-0">id</span><span class="hl-1">) !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">			</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><br/><span class="hl-1">				</span><span class="hl-3">`job worker </span><span class="hl-5">${</span><span class="hl-0">worker</span><span class="hl-10">.</span><span class="hl-0">process</span><span class="hl-10">.</span><span class="hl-0">pid</span><span class="hl-5">}</span><span class="hl-3"> exited (signal: </span><span class="hl-5">${</span><span class="hl-0">signal</span><span class="hl-5">}</span><span class="hl-3">). Trying to respawn...`</span><br/><span class="hl-1">			);</span><br/><span class="hl-1">			</span><span class="hl-2">removeJobWorker</span><span class="hl-1">(</span><span class="hl-0">worker</span><span class="hl-1">.</span><span class="hl-0">id</span><span class="hl-1">);</span><br/><span class="hl-1">			</span><span class="hl-2">addJobWorker</span><span class="hl-1">();</span><br/><span class="hl-1">		}</span><br/><br/><span class="hl-1">		</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">webWorkers</span><span class="hl-1">.</span><span class="hl-2">indexOf</span><span class="hl-1">(</span><span class="hl-0">worker</span><span class="hl-1">.</span><span class="hl-0">id</span><span class="hl-1">) !== -</span><span class="hl-4">1</span><span class="hl-1">) {</span><br/><span class="hl-1">			</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><br/><span class="hl-1">				</span><span class="hl-3">`http worker </span><span class="hl-5">${</span><span class="hl-0">worker</span><span class="hl-10">.</span><span class="hl-0">process</span><span class="hl-10">.</span><span class="hl-0">pid</span><span class="hl-5">}</span><span class="hl-3"> exited (signal: </span><span class="hl-5">${</span><span class="hl-0">signal</span><span class="hl-5">}</span><span class="hl-3">). Trying to respawn...`</span><br/><span class="hl-1">			);</span><br/><span class="hl-1">			</span><span class="hl-2">removeWebWorker</span><span class="hl-1">(</span><span class="hl-0">worker</span><span class="hl-1">.</span><span class="hl-0">id</span><span class="hl-1">);</span><br/><span class="hl-1">			</span><span class="hl-2">addWebWorker</span><span class="hl-1">();</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">} </span><span class="hl-8">else</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-0">web</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">`start http server: </span><span class="hl-5">${</span><span class="hl-0">cluster</span><span class="hl-10">.</span><span class="hl-0">worker</span><span class="hl-10">.</span><span class="hl-0">id</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">		</span><span class="hl-7">// Initialize the http server here</span><br/><span class="hl-1">		</span><span class="hl-0">httpServer</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span><br/><span class="hl-1">	}</span><br/><br/><span class="hl-1">	</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-0">job</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">`start job server: </span><span class="hl-5">${</span><span class="hl-0">cluster</span><span class="hl-10">.</span><span class="hl-0">worker</span><span class="hl-10">.</span><span class="hl-0">id</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">		</span><span class="hl-7">// Initialize the Agenda here</span><br/><span class="hl-1">		</span><span class="hl-0">jobWorker</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">();</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">addWebWorker</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-0">webWorkers</span><span class="hl-1">.</span><span class="hl-2">push</span><span class="hl-1">(</span><span class="hl-0">cluster</span><span class="hl-1">.</span><span class="hl-2">fork</span><span class="hl-1">({ </span><span class="hl-0">web:</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1"> }).</span><span class="hl-0">id</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">addJobWorker</span><span class="hl-1">() {</span><br/><span class="hl-1">	</span><span class="hl-0">jobWorkers</span><span class="hl-1">.</span><span class="hl-2">push</span><span class="hl-1">(</span><span class="hl-0">cluster</span><span class="hl-1">.</span><span class="hl-2">fork</span><span class="hl-1">({ </span><span class="hl-0">job:</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1"> }).</span><span class="hl-0">id</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">removeWebWorker</span><span class="hl-1">(</span><span class="hl-0">id</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">webWorkers</span><span class="hl-1">.</span><span class="hl-2">splice</span><span class="hl-1">(</span><span class="hl-0">webWorkers</span><span class="hl-1">.</span><span class="hl-2">indexOf</span><span class="hl-1">(</span><span class="hl-0">id</span><span class="hl-1">), </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">removeJobWorker</span><span class="hl-1">(</span><span class="hl-0">id</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">jobWorkers</span><span class="hl-1">.</span><span class="hl-2">splice</span><span class="hl-1">(</span><span class="hl-0">jobWorkers</span><span class="hl-1">.</span><span class="hl-2">indexOf</span><span class="hl-1">(</span><span class="hl-0">id</span><span class="hl-1">), </span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

					<a id="recovering-lost-mongo-connections-auto_reconnect" class="tsd-anchor"></a>
					<h3 class="tsd-anchor-link">
						Recovering lost Mongo connections (&quot;auto_reconnect&quot;)<a
							href="#recovering-lost-mongo-connections-auto_reconnect"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h3>
					<p>
						Agenda is configured by default to automatically reconnect indefinitely, emitting an
						<a href="#agenda-events">error event</a> when no connection is available on each
						<a href="#processeveryinterval">process tick</a>, allowing you to restore the Mongo instance
						without having to restart the application.
					</p>
					<p>
						However, if you are using an
						<a href="#mongomongoclientinstance">existing Mongo client</a> you'll need to configure the
						<code>reconnectTries</code> and <code>reconnectInterval</code>
						<a
							href="http://mongodb.github.io/node-mongodb-native/3.0/reference/connecting/connection-settings/"
							target="_blank"
							class="external"
							>connection settings</a
						>
						manually, otherwise you'll find that Agenda will throw an error with the message &quot;MongoDB
						connection is not recoverable, application restart required&quot; if the connection cannot be
						recovered within 30 seconds.
					</p>
					<a id="example-project-structure" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Example Project Structure<a
							href="#example-project-structure"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>
						Agenda will only process jobs that it has definitions for. This allows you to selectively choose
						which jobs a given agenda will process.
					</p>
					<p>
						Consider the following project structure, which allows us to share models with the rest of our
						code base, and specify which jobs a worker processes, if any at all.
					</p>
					<pre><code><span class="hl-1">- </span><span class="hl-0">server</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">- </span><span class="hl-0">worker</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-0">lib</span><span class="hl-1">/</span><br/><span class="hl-1">  - </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">  </span><span class="hl-0">controllers</span><span class="hl-1">/</span><br/><span class="hl-1">    - </span><span class="hl-0">user</span><span class="hl-1">-</span><span class="hl-0">controller</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">  </span><span class="hl-0">jobs</span><span class="hl-1">/</span><br/><span class="hl-1">    - </span><span class="hl-0">email</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">    - </span><span class="hl-0">video</span><span class="hl-1">-</span><span class="hl-0">processing</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">    - </span><span class="hl-0">image</span><span class="hl-1">-</span><span class="hl-0">processing</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">   </span><span class="hl-0">models</span><span class="hl-1">/</span><br/><span class="hl-1">     - </span><span class="hl-0">user</span><span class="hl-1">-</span><span class="hl-0">model</span><span class="hl-1">.</span><span class="hl-0">js</span><br/><span class="hl-1">     - </span><span class="hl-0">blog</span><span class="hl-1">-</span><span class="hl-0">post</span><span class="hl-1">.</span><span class="hl-0">model</span><span class="hl-1">.</span><span class="hl-0">js</span>
</code><button>Copy</button></pre>

					<p>Sample job processor (eg. <code>jobs/email.js</code>)</p>
					<pre><code class="js"><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-0">email</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;some-email-lib&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">	</span><span class="hl-0">User</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;../models/user-model.js&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-11">module</span><span class="hl-1">.</span><span class="hl-11">exports</span><span class="hl-1"> = </span><span class="hl-5">function</span><span class="hl-1"> (</span><span class="hl-0">agenda</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;registration email&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">User</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-0">attrs</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">.</span><span class="hl-0">userId</span><span class="hl-1">);</span><br/><span class="hl-1">		</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">email</span><span class="hl-1">(</span><br/><span class="hl-1">			</span><span class="hl-0">user</span><span class="hl-1">.</span><span class="hl-2">email</span><span class="hl-1">(),</span><br/><span class="hl-1">			</span><span class="hl-3">&quot;Thanks for registering&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">			</span><span class="hl-3">&quot;Thanks for registering &quot;</span><span class="hl-1"> + </span><span class="hl-0">user</span><span class="hl-1">.</span><span class="hl-2">name</span><span class="hl-1">()</span><br/><span class="hl-1">		);</span><br/><span class="hl-1">	});</span><br/><br/><span class="hl-1">	</span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">define</span><span class="hl-1">(</span><span class="hl-3">&quot;reset password&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-0">job</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-7">// Etc</span><br/><span class="hl-1">	});</span><br/><br/><span class="hl-1">	</span><span class="hl-7">// More email related jobs</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

					<p>lib/agenda.js</p>
					<pre><code class="js"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">Agenda</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;agenda&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">connectionOpts</span><span class="hl-1"> = {</span><br/><span class="hl-1">	</span><span class="hl-0">db:</span><span class="hl-1"> { </span><span class="hl-0">address:</span><span class="hl-1"> </span><span class="hl-3">&quot;localhost:27017/agenda-test&quot;</span><span class="hl-1">, </span><span class="hl-0">collection:</span><span class="hl-1"> </span><span class="hl-3">&quot;agendaJobs&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">(</span><span class="hl-0">connectionOpts</span><span class="hl-1">);</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">jobTypes</span><span class="hl-1"> = </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-6">JOB_TYPES</span><span class="hl-1"> ? </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">env</span><span class="hl-1">.</span><span class="hl-6">JOB_TYPES</span><span class="hl-1">.</span><span class="hl-2">split</span><span class="hl-1">(</span><span class="hl-3">&quot;,&quot;</span><span class="hl-1">) : [];</span><br/><br/><span class="hl-0">jobTypes</span><span class="hl-1">.</span><span class="hl-2">forEach</span><span class="hl-1">((</span><span class="hl-0">type</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;./jobs/&quot;</span><span class="hl-1"> + </span><span class="hl-0">type</span><span class="hl-1">)(</span><span class="hl-0">agenda</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">jobTypes</span><span class="hl-1">.</span><span class="hl-0">length</span><span class="hl-1">) {</span><br/><span class="hl-1">	</span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">start</span><span class="hl-1">(); </span><span class="hl-7">// Returns a promise, which should be handled appropriately</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-11">module</span><span class="hl-1">.</span><span class="hl-11">exports</span><span class="hl-1"> = </span><span class="hl-0">agenda</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

					<p>lib/controllers/user-controller.js</p>
					<pre><code class="js"><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-0">app</span><span class="hl-1"> = </span><span class="hl-2">express</span><span class="hl-1">(),</span><br/><span class="hl-1">	</span><span class="hl-0">User</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;../models/user-model&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">	</span><span class="hl-0">agenda</span><span class="hl-1"> = </span><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;../worker.js&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-0">app</span><span class="hl-1">.</span><span class="hl-2">post</span><span class="hl-1">(</span><span class="hl-3">&quot;/users&quot;</span><span class="hl-1">, (</span><span class="hl-0">req</span><span class="hl-1">, </span><span class="hl-0">res</span><span class="hl-1">, </span><span class="hl-0">next</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">User</span><span class="hl-1">(</span><span class="hl-0">req</span><span class="hl-1">.</span><span class="hl-0">body</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-0">user</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">((</span><span class="hl-0">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">err</span><span class="hl-1">) {</span><br/><span class="hl-1">			</span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-2">next</span><span class="hl-1">(</span><span class="hl-0">err</span><span class="hl-1">);</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">		</span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">now</span><span class="hl-1">(</span><span class="hl-3">&quot;registration email&quot;</span><span class="hl-1">, { </span><span class="hl-0">userId:</span><span class="hl-1"> </span><span class="hl-0">user</span><span class="hl-1">.</span><span class="hl-2">primary</span><span class="hl-1">() });</span><br/><span class="hl-1">		</span><span class="hl-0">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-4">201</span><span class="hl-1">, </span><span class="hl-0">user</span><span class="hl-1">.</span><span class="hl-2">toJson</span><span class="hl-1">());</span><br/><span class="hl-1">	});</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

					<p>worker.js</p>
					<pre><code class="js"><span class="hl-2">require</span><span class="hl-1">(</span><span class="hl-3">&quot;./lib/agenda.js&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

					<p>Now you can do the following in your project:</p>
					<pre><code class="bash"><span class="hl-2">node</span><span class="hl-1"> </span><span class="hl-3">server.js</span>
</code><button type="button">Copy</button></pre>

					<p>
						Fire up an instance with no <code>JOB_TYPES</code>, giving you the ability to process jobs, but
						not wasting resources processing jobs.
					</p>
					<pre><code class="bash"><span class="hl-0">JOB_TYPES</span><span class="hl-1">=</span><span class="hl-3">email</span><span class="hl-1"> </span><span class="hl-2">node</span><span class="hl-1"> </span><span class="hl-3">server.js</span>
</code><button type="button">Copy</button></pre>

					<p>Allow your http server to process email jobs.</p>
					<pre><code class="bash"><span class="hl-0">JOB_TYPES</span><span class="hl-1">=</span><span class="hl-3">email</span><span class="hl-1"> </span><span class="hl-2">node</span><span class="hl-1"> </span><span class="hl-3">worker.js</span>
</code><button type="button">Copy</button></pre>

					<p>Fire up an instance that processes email jobs.</p>
					<pre><code class="bash"><span class="hl-0">JOB_TYPES</span><span class="hl-1">=</span><span class="hl-3">video-processing,image-processing</span><span class="hl-1"> </span><span class="hl-2">node</span><span class="hl-1"> </span><span class="hl-3">worker.js</span>
</code><button type="button">Copy</button></pre>

					<p>
						Fire up an instance that processes video-processing/image-processing jobs. Good for a heavy
						hitting server.
					</p>
					<a id="debugging-issues" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Debugging Issues<a href="#debugging-issues" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>If you think you have encountered a bug, please feel free to report it here:</p>
					<p>
						<a href="https://github.com/hokify/agenda/issues/new" target="_blank" class="external"
							>Submit Issue</a
						>
					</p>
					<p>Please provide us with as much details as possible such as:</p>
					<ul>
						<li>Agenda version</li>
						<li>Environment (OSX, Linux, Windows, etc)</li>
						<li>Small description of what happened</li>
						<li>Any relevant stack track</li>
						<li>Agenda logs (see below)</li>
					</ul>
					<a id="to-turn-on-logging-please-set-your-debug-env-variable-like-so" class="tsd-anchor"></a>
					<h4 class="tsd-anchor-link">
						To turn on logging, please set your DEBUG env variable like so:<a
							href="#to-turn-on-logging-please-set-your-debug-env-variable-like-so"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h4>
					<ul>
						<li>OSX: <code>DEBUG=&quot;agenda:*&quot; ts-node src/index.ts</code></li>
						<li>Linux: <code>DEBUG=&quot;agenda:*&quot; ts-node src/index.ts</code></li>
						<li>Windows CMD: <code>set DEBUG=agenda:*</code></li>
						<li>Windows PowerShell: <code>$env:DEBUG = &quot;agenda:*&quot;</code></li>
					</ul>
					<p>
						While not necessary, attaching a text file with this debug information would be extremely useful
						in debugging certain issues and is encouraged.
					</p>
					<a id="known-issues" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Known Issues<a href="#known-issues" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<a
						id="multiple-order-by-items-are-not-supported-please-specify-a-single-order-by-item"
						class="tsd-anchor"
					></a>
					<h4 class="tsd-anchor-link">
						&quot;Multiple order-by items are not supported. Please specify a single order-by item.&quot;<a
							href="#multiple-order-by-items-are-not-supported-please-specify-a-single-order-by-item"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h4>
					<p>
						When running Agenda on Azure cosmosDB, you might run into this issue caused by Agenda's sort
						query used for finding and locking the next job. To fix this, you can pass
						<a href="#sortquery">custom sort option</a>: <code>sort: { nextRunAt: 1 }</code>
					</p>
					<a id="performance" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Performance<a href="#performance" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>It is recommended to set this index if you use agendash:</p>
					<pre><code><span class="hl-0">db</span><span class="hl-1">.</span><span class="hl-0">agendaJobs</span><span class="hl-1">.</span><span class="hl-2">ensureIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;nextRunAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> -</span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;lastRunAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> -</span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;lastFinishedAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> -</span><span class="hl-4">1</span><br/><span class="hl-1">}, </span><span class="hl-3">&quot;agendash2&quot;</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

					<p>
						If you have one job definition with thousand of instances, you can add this index to improve
						internal sorting query for faster sortings
					</p>
					<pre><code><span class="hl-0">db</span><span class="hl-1">.</span><span class="hl-0">agendaJobs</span><span class="hl-1">.</span><span class="hl-2">ensureIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;name&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;disabled&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">&quot;lockedAt&quot;</span><span class="hl-0"> :</span><span class="hl-1"> </span><span class="hl-4">1</span><br/><span class="hl-1">}, </span><span class="hl-3">&quot;findAndLockDeadJobs&quot;</span><span class="hl-1">)</span>
</code><button>Copy</button></pre>

					<a id="sandboxed-worker---use-child-processes" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Sandboxed Worker - use child processes<a
							href="#sandboxed-worker---use-child-processes"
							aria-label="Permalink"
							class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<p>
						It's possible to start jobs in a child process, this helps for example for long running
						processes to seperate them from the main thread. For example if one process consumes too much
						memory and gets killed, it will not affect any others. To use this feature, several steps are
						required. 1.) create a childWorker helper. The subrocess has a complete seperate context, so
						there are no database connections or anything else that can be shared. Therefore you have to
						ensure that all required connections and initializations are done here too. Furthermore you also
						have to load the correct job definition so that agenda nows what code it must execute. Therefore
						3 parameters are passed to the childWorker: name, jobId and path to the job definition.
					</p>
					<p>Example file can look like this:</p>
					<p>childWorker.ts</p>
					<pre><code class="ts"><span class="hl-8">import</span><span class="hl-1"> </span><span class="hl-3">&#39;reflect-metadata&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-2">isCancelMessage</span><span class="hl-1">(</span><span class="hl-0">message</span><span class="hl-1">): </span><span class="hl-0">message</span><span class="hl-1"> </span><span class="hl-5">is</span><span class="hl-1"> { </span><span class="hl-9">type</span><span class="hl-1">: </span><span class="hl-3">&#39;cancel&#39;</span><span class="hl-1">; </span><span class="hl-9">error</span><span class="hl-1">: </span><span class="hl-0">string</span><span class="hl-1"> } {</span><br/><span class="hl-1">	</span><span class="hl-8">return</span><span class="hl-1"> </span><span class="hl-0">message</span><span class="hl-1"> !== </span><span class="hl-5">null</span><span class="hl-1"> &amp;&amp; </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-0">message</span><span class="hl-1"> === </span><span class="hl-3">&#39;object&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">message</span><span class="hl-1">.</span><span class="hl-0">type</span><span class="hl-1"> === </span><span class="hl-3">&#39;cancel&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-1">(</span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">mongooseConnection</span><span class="hl-1"> = </span><span class="hl-7">/** connect to database */</span><br/><br/><span class="hl-1">  </span><span class="hl-7">/** do other required initializations */</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// get process arguments (name, jobId and path to agenda definition file)</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> [, , </span><span class="hl-6">name</span><span class="hl-1">, </span><span class="hl-6">jobId</span><span class="hl-1">, </span><span class="hl-6">agendaDefinition</span><span class="hl-1">] = </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">argv</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// set fancy process title</span><br/><span class="hl-1">	</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">title</span><span class="hl-1"> = </span><span class="hl-3">`</span><span class="hl-5">${</span><span class="hl-0">process</span><span class="hl-10">.</span><span class="hl-0">title</span><span class="hl-5">}</span><span class="hl-3"> (sub worker: </span><span class="hl-5">${</span><span class="hl-0">name</span><span class="hl-5">}</span><span class="hl-3">/</span><span class="hl-5">${</span><span class="hl-0">jobId</span><span class="hl-5">}</span><span class="hl-3">)`</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// initialize Agenda in &quot;forkedWorker&quot; mode</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">agenda</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Agenda</span><span class="hl-1">({ </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">`subworker-</span><span class="hl-5">${</span><span class="hl-0">name</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-0">forkedWorker:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> });</span><br/><span class="hl-1">	</span><span class="hl-7">// connect agenda (but do not start it)</span><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">mongo</span><span class="hl-1">(</span><span class="hl-0">mongooseConnection</span><span class="hl-1">.</span><span class="hl-0">db</span><span class="hl-1"> </span><span class="hl-8">as</span><span class="hl-1"> </span><span class="hl-11">any</span><span class="hl-1">);</span><br/><br/><span class="hl-1">	</span><span class="hl-8">if</span><span class="hl-1"> (!</span><span class="hl-0">name</span><span class="hl-1"> || !</span><span class="hl-0">jobId</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-8">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-2">Error</span><span class="hl-1">(</span><span class="hl-3">`invalid parameters: </span><span class="hl-5">${</span><span class="hl-6">JSON</span><span class="hl-10">.</span><span class="hl-2">stringify</span><span class="hl-10">(</span><span class="hl-0">process</span><span class="hl-10">.</span><span class="hl-0">argv</span><span class="hl-10">)</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// load job definition</span><br/><span class="hl-1">  </span><span class="hl-7">/** in this case the file is for example ../some/path/definitions.js</span><br/><span class="hl-7">  with a content like:</span><br/><span class="hl-7">  export default (agenda: Agenda, definitionOnly = false) =&gt; {</span><br/><span class="hl-7">    agenda.define(</span><br/><span class="hl-7">      &#39;some job&#39;,</span><br/><span class="hl-7">      async (notification: {</span><br/><span class="hl-7">        attrs: { data: { dealId: string; orderId: TypeObjectId&lt;IOrder&gt; } };</span><br/><span class="hl-7">      }) =&gt; {</span><br/><span class="hl-7">        // do something</span><br/><span class="hl-7">      }</span><br/><span class="hl-7">    );</span><br/><br/><span class="hl-7">    if (!definitionOnly) {</span><br/><span class="hl-7">        // here you can create scheduled jobs or other things</span><br/><span class="hl-7">    }</span><br/><span class="hl-7">	});</span><br/><span class="hl-7">  */</span><br/><span class="hl-1">	</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">agendaDefinition</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">loadDefinition</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-2">import</span><span class="hl-1">(</span><span class="hl-0">agendaDefinition</span><span class="hl-1">);</span><br/><span class="hl-1">		(</span><span class="hl-0">loadDefinition</span><span class="hl-1">.</span><span class="hl-0">default</span><span class="hl-1"> || </span><span class="hl-0">loadDefinition</span><span class="hl-1">)(</span><span class="hl-0">agenda</span><span class="hl-1">, </span><span class="hl-5">true</span><span class="hl-1">);</span><br/><span class="hl-1">	}</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// run this job now</span><br/><span class="hl-1">	</span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">job</span><span class="hl-1"> = </span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">getForkedJob</span><span class="hl-1">(</span><span class="hl-0">jobId</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">on</span><span class="hl-1">(</span><span class="hl-3">&#39;message&#39;</span><span class="hl-1">, </span><span class="hl-0">message</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">		</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-2">isCancelMessage</span><span class="hl-1">(</span><span class="hl-0">message</span><span class="hl-1">)) {</span><br/><span class="hl-1">			</span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">cancel</span><span class="hl-1">(</span><span class="hl-0">message</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">);</span><br/><span class="hl-1">			</span><span class="hl-2">setTimeout</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">				</span><span class="hl-7">// kill it after 10 seconds</span><br/><span class="hl-1">				</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">exit</span><span class="hl-1">(</span><span class="hl-4">2</span><span class="hl-1">);</span><br/><span class="hl-1">			}, </span><span class="hl-4">10000</span><span class="hl-1">);</span><br/><span class="hl-1">		} </span><span class="hl-8">else</span><span class="hl-1"> {</span><br/><span class="hl-1">			</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">log</span><span class="hl-1">(</span><span class="hl-3">&#39;got message&#39;</span><span class="hl-1">, </span><span class="hl-0">message</span><span class="hl-1">);</span><br/><span class="hl-1">		}</span><br/><span class="hl-1">	});</span><br/><br/><span class="hl-1">	</span><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">runJob</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// disconnect database and exit</span><br/><span class="hl-1">	</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">exit</span><span class="hl-1">(</span><span class="hl-4">0</span><span class="hl-1">);</span><br/><span class="hl-1">})().</span><span class="hl-2">catch</span><span class="hl-1">(</span><span class="hl-0">err</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">	</span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">(</span><span class="hl-3">&#39;err&#39;</span><span class="hl-1">, </span><span class="hl-0">err</span><span class="hl-1">);</span><br/><span class="hl-1">	</span><span class="hl-8">if</span><span class="hl-1"> (</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">) {</span><br/><span class="hl-1">		</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-2">stringify</span><span class="hl-1">(</span><span class="hl-0">err</span><span class="hl-1">));</span><br/><span class="hl-1">	}</span><br/><span class="hl-1">	</span><span class="hl-0">process</span><span class="hl-1">.</span><span class="hl-2">exit</span><span class="hl-1">(</span><span class="hl-4">1</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/>
</code><button type="button">Copy</button></pre>

					<p>
						Ensure to only define job definitions during this step, otherwise you create some overhead (e.g.
						if you create new jobs inside the defintion files). That's why I call the defintion file with
						agenda and a second paramter that is set to true. If this parameter is true, I do not initialize
						any jobs (create jobs etc..)
					</p>
					<p>2.) to use this, you have to enable it on a job. Set forkMode to true:</p>
					<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">job</span><span class="hl-1"> = </span><span class="hl-0">agenda</span><span class="hl-1">.</span><span class="hl-2">create</span><span class="hl-1">(</span><span class="hl-3">&quot;some job&quot;</span><span class="hl-1">, { </span><span class="hl-0">meep:</span><span class="hl-1"> </span><span class="hl-4">1</span><span class="hl-1"> });</span><br/><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">forkMode</span><span class="hl-1">(</span><span class="hl-5">true</span><span class="hl-1">);</span><br/><span class="hl-8">await</span><span class="hl-1"> </span><span class="hl-0">job</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

					<a id="acknowledgements" class="tsd-anchor"></a>
					<h1 class="tsd-anchor-link">
						Acknowledgements<a href="#acknowledgements" aria-label="Permalink" class="tsd-anchor-icon"
							><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg
						></a>
					</h1>
					<ul>
						<li>
							Agenda was originally created by
							<a href="https://github.com/rschmukler" target="_blank" class="external">@rschmukler</a>.
						</li>
						<li>
							<a href="https://github.com/agenda/agendash" target="_blank" class="external">Agendash</a>
							was originally created by
							<a href="https://github.com/joeframbach" target="_blank" class="external">@joeframbach</a>.
						</li>
					</ul>
				</div>
			</div>
			<div class="col-sidebar">
				<div class="page-menu">
					<div class="tsd-navigation settings">
						<details class="tsd-accordion">
							<summary class="tsd-accordion-summary">
								<h3>
									<svg width="20" height="20" viewBox="0 0 24 24" fill="none">
										<use href="assets/icons.svg#icon-chevronDown"></use></svg
									>Settings
								</h3>
							</summary>
							<div class="tsd-accordion-details">
								<div class="tsd-filter-visibility">
									<span class="settings-label">Member Visibility</span>
									<ul id="tsd-filter-options">
										<li class="tsd-filter-item">
											<label class="tsd-filter-input"
												><input
													type="checkbox"
													id="tsd-filter-protected"
													name="protected"
												/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true">
													<rect
														class="tsd-checkbox-background"
														width="30"
														height="30"
														x="1"
														y="1"
														rx="6"
														fill="none"
													></rect>
													<path
														class="tsd-checkbox-checkmark"
														d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
														stroke="none"
														stroke-width="3.5"
														stroke-linejoin="round"
														fill="none"
													></path></svg
												><span>Protected</span></label
											>
										</li>
										<li class="tsd-filter-item">
											<label class="tsd-filter-input"
												><input
													type="checkbox"
													id="tsd-filter-inherited"
													name="inherited"
													checked
												/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true">
													<rect
														class="tsd-checkbox-background"
														width="30"
														height="30"
														x="1"
														y="1"
														rx="6"
														fill="none"
													></rect>
													<path
														class="tsd-checkbox-checkmark"
														d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
														stroke="none"
														stroke-width="3.5"
														stroke-linejoin="round"
														fill="none"
													></path></svg
												><span>Inherited</span></label
											>
										</li>
										<li class="tsd-filter-item">
											<label class="tsd-filter-input"
												><input type="checkbox" id="tsd-filter-external" name="external" /><svg
													width="32"
													height="32"
													viewBox="0 0 32 32"
													aria-hidden="true"
												>
													<rect
														class="tsd-checkbox-background"
														width="30"
														height="30"
														x="1"
														y="1"
														rx="6"
														fill="none"
													></rect>
													<path
														class="tsd-checkbox-checkmark"
														d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25"
														stroke="none"
														stroke-width="3.5"
														stroke-linejoin="round"
														fill="none"
													></path></svg
												><span>External</span></label
											>
										</li>
									</ul>
								</div>
								<div class="tsd-theme-toggle">
									<label class="settings-label" for="tsd-theme">Theme</label
									><select id="tsd-theme">
										<option value="os">OS</option>
										<option value="light">Light</option>
										<option value="dark">Dark</option>
									</select>
								</div>
							</div>
						</details>
					</div>
					<details open class="tsd-accordion tsd-page-navigation">
						<summary class="tsd-accordion-summary">
							<h3>
								<svg width="20" height="20" viewBox="0 0 24 24" fill="none">
									<use href="assets/icons.svg#icon-chevronDown"></use></svg
								>On This Page
							</h3>
						</summary>
						<div class="tsd-accordion-details">
							<a href="#lesjoursfragenda"><span>@lesjoursfr/agenda</span></a
							><a href="#agenda-offers"><span>Agenda offers</span></a>
							<ul>
								<li>
									<ul>
										<li>
											<a href="#feature-comparison"
												><span>Feature <wbr />Comparison</span></a
											>
										</li>
									</ul>
								</li>
							</ul>
							<a href="#installation"><span>Installation</span></a
							><a href="#example-usage"
								><span>Example <wbr />Usage</span></a
							><a href="#full-documentation"><span>Full documentation</span></a>
							<ul>
								<li>
									<a href="#table-of-contents"
										><span>Table of <wbr />Contents</span></a
									>
								</li>
								<li>
									<a href="#configuring-an-agenda"><span>Configuring an agenda</span></a>
								</li>
								<li>
									<ul>
										<li>
											<a href="#databaseurl-collectionname-mongoclientoptions"
												><span
													>database(url, [collection<wbr />Name], [<wbr />Mongo<wbr />Client<wbr />Options])</span
												></a
											>
										</li>
										<li>
											<a href="#mongodbinstance-collectionname"
												><span>mongo(db<wbr />Instance, [collection<wbr />Name])</span></a
											>
										</li>
										<li>
											<a href="#namename"><span>name(name)</span></a>
										</li>
										<li>
											<a href="#processeveryinterval"
												><span>process<wbr />Every(interval)</span></a
											>
										</li>
										<li>
											<a href="#maxconcurrencynumber"
												><span>max<wbr />Concurrency(number)</span></a
											>
										</li>
										<li>
											<a href="#defaultconcurrencynumber"
												><span>default<wbr />Concurrency(number)</span></a
											>
										</li>
										<li>
											<a href="#locklimitnumber"
												><span>lock<wbr />Limit(number)</span></a
											>
										</li>
										<li>
											<a href="#defaultlocklimitnumber"
												><span>default<wbr />Lock<wbr />Limit(number)</span></a
											>
										</li>
										<li>
											<a href="#defaultlocklifetimenumber"
												><span>default<wbr />Lock<wbr />Lifetime(number)</span></a
											>
										</li>
										<li>
											<a href="#sortquery"><span>sort(query)</span></a>
										</li>
									</ul>
								</li>
								<li>
									<a href="#agenda-events"
										><span>Agenda <wbr />Events</span></a
									>
								</li>
								<li>
									<a href="#defining-job-processors"
										><span>Defining <wbr />Job <wbr />Processors</span></a
									>
								</li>
								<li>
									<ul>
										<li>
											<a href="#definejobname-fn-options"
												><span>define(job<wbr />Name, fn, [options])</span></a
											>
										</li>
									</ul>
								</li>
								<li>
									<a href="#creating-jobs"
										><span>Creating <wbr />Jobs</span></a
									>
								</li>
								<li>
									<ul>
										<li>
											<a href="#everyinterval-name-data-options"
												><span>every(interval, name, [data], [options])</span></a
											>
										</li>
										<li>
											<a href="#schedulewhen-name-data"
												><span>schedule(when, name, [data])</span></a
											>
										</li>
										<li>
											<a href="#nowname-data"><span>now(name, [data])</span></a>
										</li>
										<li>
											<a href="#createjobname-data"
												><span>create(job<wbr />Name, data)</span></a
											>
										</li>
									</ul>
								</li>
								<li>
									<a href="#managing-jobs"
										><span>Managing <wbr />Jobs</span></a
									>
								</li>
								<li>
									<ul>
										<li>
											<a
												href="#jobsmongodb-native-query-mongodb-native-sort-mongodb-native-limit-mongodb-native-skip"
												><span
													>jobs(mongodb-<wbr />native query, mongodb-<wbr />native sort,
													mongodb-<wbr />native limit, mongodb-<wbr />native skip)</span
												></a
											>
										</li>
										<li>
											<a href="#cancelmongodb-native-query"
												><span>cancel(mongodb-<wbr />native query)</span></a
											>
										</li>
										<li>
											<a href="#purge"><span>purge()</span></a>
										</li>
									</ul>
								</li>
								<li>
									<a href="#starting-the-job-processor"><span>Starting the job processor</span></a>
								</li>
								<li>
									<ul>
										<li>
											<a href="#start"><span>start</span></a>
										</li>
										<li>
											<a href="#stop"><span>stop</span></a>
										</li>
									</ul>
								</li>
								<li>
									<a href="#multiple-job-processors"><span>Multiple job processors</span></a>
								</li>
								<li>
									<a href="#manually-working-with-a-job"><span>Manually working with a job</span></a>
								</li>
								<li>
									<ul>
										<li>
											<a href="#repeateveryinterval-options"
												><span>repeat<wbr />Every(interval, [options])</span></a
											>
										</li>
										<li>
											<a href="#repeatattime"
												><span>repeat<wbr />At(time)</span></a
											>
										</li>
										<li>
											<a href="#scheduletime"><span>schedule(time)</span></a>
										</li>
										<li>
											<a href="#prioritypriority"><span>priority(priority)</span></a>
										</li>
										<li>
											<a href="#uniqueproperties-options"
												><span>unique(properties, [options])</span></a
											>
										</li>
										<li>
											<a href="#failreason"><span>fail(reason)</span></a>
										</li>
										<li>
											<a href="#runcallback"><span>run(callback)</span></a>
										</li>
										<li>
											<a href="#save"><span>save()</span></a>
										</li>
										<li>
											<a href="#remove"><span>remove()</span></a>
										</li>
										<li>
											<a href="#disable"><span>disable()</span></a>
										</li>
										<li>
											<a href="#enable"><span>enable()</span></a>
										</li>
										<li>
											<a href="#touch"><span>touch()</span></a>
										</li>
									</ul>
								</li>
								<li>
									<a href="#job-queue-events"
										><span>Job <wbr />Queue <wbr />Events</span></a
									>
								</li>
								<li>
									<a href="#frequently-asked-questions"
										><span>Frequently <wbr />Asked <wbr />Questions</span></a
									>
								</li>
								<li>
									<ul>
										<li>
											<a href="#what-is-the-order-in-which-jobs-run"
												><span>What is the order in which jobs run?</span></a
											>
										</li>
										<li>
											<a href="#what-is-the-difference-between-locklimit-and-maxconcurrency"
												><span
													>What is the difference between lock<wbr />Limit and max<wbr />Concurrency?</span
												></a
											>
										</li>
										<li>
											<a href="#sample-project-structure"
												><span>Sample <wbr />Project <wbr />Structure?</span></a
											>
										</li>
										<li>
											<a href="#can-i-donate"
												><span>Can <wbr />I <wbr />Donate?</span></a
											>
										</li>
										<li>
											<a href="#web-interface"
												><span>Web <wbr />Interface?</span></a
											>
										</li>
										<li>
											<a href="#mongo-vs-redis"
												><span>Mongo vs <wbr />Redis</span></a
											>
										</li>
										<li>
											<a href="#spawning--forking-processes"
												><span>Spawning / forking processes</span></a
											>
										</li>
										<li>
											<a href="#recovering-lost-mongo-connections-auto_reconnect"
												><span
													>Recovering lost <wbr />Mongo connections (&quot;auto_<wbr />reconnect&quot;)</span
												></a
											>
										</li>
									</ul>
								</li>
							</ul>
							<a href="#example-project-structure"
								><span>Example <wbr />Project <wbr />Structure</span></a
							><a href="#debugging-issues"
								><span>Debugging <wbr />Issues</span></a
							>
							<ul>
								<li>
									<ul>
										<li>
											<ul>
												<li>
													<a
														href="#to-turn-on-logging-please-set-your-debug-env-variable-like-so"
														><span
															>To turn on logging, please set your DEBUG env variable like
															so:</span
														></a
													>
												</li>
											</ul>
										</li>
									</ul>
								</li>
							</ul>
							<a href="#known-issues"
								><span>Known <wbr />Issues</span></a
							>
							<ul>
								<li>
									<ul>
										<li>
											<ul>
												<li>
													<a
														href="#multiple-order-by-items-are-not-supported-please-specify-a-single-order-by-item"
														><span
															>&quot;<wbr />Multiple order-<wbr />by items are not
															supported. <wbr />Please specify a single order-<wbr />by
															item.&quot;</span
														></a
													>
												</li>
											</ul>
										</li>
									</ul>
								</li>
							</ul>
							<a href="#performance"><span>Performance</span></a
							><a href="#sandboxed-worker---use-child-processes"
								><span>Sandboxed <wbr />Worker -<wbr /> use child processes</span></a
							><a href="#acknowledgements"><span>Acknowledgements</span></a>
						</div>
					</details>
				</div>
				<div class="site-menu">
					<nav class="tsd-navigation">
						<a href="modules.html" class="current">@lesjoursfr/agenda</a>
						<ul class="tsd-small-nested-navigation" id="tsd-nav-container">
							<li>Loading...</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
		<footer>
			<p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
		</footer>
		<div class="overlay"></div>
	</body>
</html>
